# 영속성 컨텍스트(Persistence Context)

### 📌 정의

엔티티를 영구 저장하는 환경이라는 뜻이다.

### 1️⃣ 1차 캐시

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbfygws%2FbtqXZJabbrb%2FvwIQ6WAapW6nTSWjd8SiD1%2Fimg.png)

영속성 컨텍스트 **내부**에 엔티티를 보관하는 **저장소**가 있다. 이를 1차 캐시라고 한다.

일반적으로 트랜잭션을 시작하고 종료할 때까지만 1차 캐시가 **유효하다.**

OSIV를 사용하더라도 사용자의 요청이 들어올 때부터 끝날 때까지만 1차 캐시가 유효하다.

##### 특징

같은 엔티티가 있으면 **객체 동일성을 보장**한다.

### 2️⃣ 2차 캐시

![JPA 2차 캐시란](https://blog.kakaocdn.net/dn/vLcZO/btqDJNIy8oP/PRtdCZROYaoDAR6s6m51d0/img.png)

**애플리케이션 범위**의 캐시로, **공유 캐시**라고도 한다.

애플리케이션을 **종료할 때** 까지 **캐시가 유지**된다.

##### 특징

동시성을 극대화하기 위해 **캐시 한 객체**를 **직접 반환하지 않고** **복사본**을 만들어서 반환한다.

복사본을 반환하는 이유는 캐시한 객체를 그대로 반환하면 여러 곳에서 같은 객체를 동시에 수정하는 **동시성 문제**가 발생할 수 있음.

영속성 컨텍스트가 다르면 **객체 동일성**을 **보장하지 않는다.**
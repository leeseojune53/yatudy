# 외부로부터 안전한 EC2, RDS를 구축하기



## 🎊 시작하기 전에..

이 글을 읽기 전에 VPC와 로드밸런서에 대한 기본적인 지식이 필요합니다.

AWS 구조는 한 AZ(가용영역) 내부에 EC2와 RDS를 구축하는 것을 목표로 합니다.

EC2는 public 서브넷, RDS는 private 서브넷으로 설정하는 것을 목표로 합니다.



### 1️⃣ 가장 먼저

##### VPC 생성

VPC생성 및 설정을 해주어야 합니다.

AWS에서 VPC로 들어간 후 **VPC 생성**을 눌러줍니다. 



##### IPv4 CIDR 블록

간단하게 CIDR은 기존의 IP 주소 할당 방식이었던 네트워크 클래스 방법을 대체한 방식입니다. CIDR은 IP Address의 영역을 나눌 때 기존방식보다 유연하게 자신이 원하는 Network Address와 Host Address를 나눌 수 있습니다.

아래의 Private IP 대역중 하나를 사용하는 것을 추천합니다😉

Private IP 대역

- A Class 10.0.0.0/8
- B Class 172.16.0.0/12
- C Class 192.168.0.0/16



설정을 마쳤다면 **VPC 생성**을 눌러줍니다.



### 2️⃣ 두 번째로

##### 서브넷 생성

VPC ID에 방금 생성했는 VPC를 선택합니다.



##### IPv4 CIDR 블록

여기에는 아까 VPC에서 입력했던 CIDR 주소 내에 있어야합니다!



EC2와 연결할 서브넷은 **퍼블릭 IP 자동 할당**을 활성화 해줘야합니다!

설정을 마쳤다면 **서브넷 생성**을 눌러줍니다.



###  3️⃣ 세 번째로

##### 보안 그룹 생성

보안그룹은 간단하게 인바운드 및 아웃바운드 트래픽을 관리하는 인스턴스의 가상 방화벽 역할합니다.



##### 인바운드 규칙

인바운드 규칙은 이 보안 그룹 안으로 들어올 수 있는 유형, 포트, 소스를 지정할 수 있습니다.



##### SSH

ssh를 허용하려면 유형을 **SSH**로 설정하고, 소스는 내 IP를 추천합니다. 이유는 Anywhere-IPv4 또는 IPv6로 설정하면 외부에서 다른 사람도 접근을 할 수 있기 때문입니다.



##### MySQL

MySQL을 허용하려면 유형을 MYSQL/Aurora로 설정하고, 소스는 위에서 생성한(SSH) 보안 그룹으로 설정합니다.



기타 설정을 끝마쳤다면 **보안 그룹 생성**을 눌러줍니다.



### 4️⃣ 네 번째로

#### EC2 생성

##### 인스턴스 구성

EC2생성에서 이전에 생성했던 VPC와 서브넷을 기입해줍니다.

##### 보안 그룹 구성

보안 그룹 구성에서 기존에 생성했던 보안 그룹을 선택합니다. (SSH 허용)



설정을 끝마쳤다면 **검토 및 시작**을 눌러줍니다.



### 5️⃣ 다섯 번째로

##### RDS 생성

RDS탭으로 이동하여 **데이터베이스 생성**을 눌러줍니다.

엔진 옵션 및 설정은 따로 하시면 됩니다.

##### VPC, 서브넷 그룹

설정에서 **연결**부분의 VPC와 서브넷 그룹을 설정해야 합니다.

이전에 생성했던 VPC를 선택한 후, 위에서 생성했던 private subnet을 선택해줍니다.

##### 보안 그룹

위에서 생성했던 보안 그룹을 선택합니다.(MYSQL/Aurora)



설정을 끝마쳤다면 **데이터베이스 생성**을 눌러줍니다.



### ✅ 끝으로

위에서 했던 설정은 외부에서 RDS는 접근이 불가하고, EC2는 자신만 접근할 수 있게 구축하였습니다. 그림으로 간단하게 표시하면 아래의 그림과 같습니다.

![protected_ec2_rds.png](https://github.com/leeseojune53/yatudy/blob/main/images/Aws/protected_ec2_rds.png?raw=true)